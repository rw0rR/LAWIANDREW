<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Yönetici Paneli - Kararlı Versiyon</title>
    <!-- Tailwind CSS CDN -->
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #111827; /* Çok koyu arkaplan */
            color: #d1d5db;
            transition: background-color 0.5s;
        }
        .sidebar {
            min-width: 250px;
            max-width: 250px;
            background-color: #1f2937;
            border-right: 1px solid #374151;
        }
        .card-bg {
            background-color: #1f2937;
            border: 1px solid #374151;
        }
        /* Flash Mesajları */
        .flash-success { background-color: #10b981; color: #ecfdf5; }
        .flash-danger { background-color: #ef4444; color: #fee2e2; }
        
        /* Modal Stili */
        #custom-modal {
            background-color: rgba(17, 24, 39, 0.8);
            backdrop-filter: blur(5px);
            z-index: 50; /* Tailwind z-50 */
        }
    </style>
    <!-- Lucide Icons -->
    <script src="https://unpkg.com/lucide@latest"></script>
</head>
<body class="flex flex-col min-h-screen">

    <!-- Ana Konteyner -->
    <div id="app-container" class="flex-grow flex">
        
        <!-- Giriş Ekranı -->
        <div id="login-screen" class="flex items-center justify-center w-full min-h-screen">
            <div class="w-full max-w-md bg-gray-800 p-8 rounded-xl shadow-2xl transition duration-500 border border-gray-700">
                <h2 class="text-3xl font-bold text-white mb-6 text-center">Uygulama Girişi</h2>
                <p class="text-center text-sm text-gray-400 mb-6">
                    Yönetici: admin/sifre123 | Kullanıcı: user1/user123
                </p>

                <!-- Flash Mesajı Gösterme Alanı -->
                <div id="login-message" class="mb-4 hidden p-3 rounded-lg text-sm border border-opacity-50" role="alert"></div>

                <form id="login-form" class="space-y-6">
                    <div>
                        <label for="username" class="block text-sm font-medium text-gray-300">Kullanıcı Adı</label>
                        <div class="mt-1">
                            <input id="username" name="username" type="text" required 
                                   class="appearance-none block w-full px-4 py-2 border border-gray-600 bg-gray-700 text-white rounded-lg shadow-sm placeholder-gray-400 focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm transition duration-150"
                                   placeholder="örn: admin veya user1">
                        </div>
                    </div>

                    <div>
                        <label for="password" class="block text-sm font-medium text-gray-300">Şifre</label>
                        <div class="mt-1">
                            <input id="password" name="password" type="password" required 
                                   class="appearance-none block w-full px-4 py-2 border border-gray-600 bg-gray-700 text-white rounded-lg shadow-sm placeholder-gray-400 focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm transition duration-150"
                                   placeholder="Şifrenizi Girin">
                        </div>
                    </div>

                    <div>
                        <button type="submit" 
                                class="w-full flex justify-center py-2 px-4 border border-transparent rounded-lg shadow-md text-sm font-medium text-white bg-indigo-600 hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500 transition duration-150 transform hover:scale-[1.01] focus:ring-offset-gray-800">
                            Giriş Yap
                        </button>
                    </div>
                </form>
            </div>
        </div>

        <!-- Ana Uygulama Arayüzü (Kullanıcı veya Yönetici Ana Sayfası) -->
        <div id="user-home-screen" class="hidden flex items-center justify-center w-full min-h-screen p-8">
             <!-- İçerik JS ile doldurulacak -->
        </div>

        <!-- Yönetici Paneli -->
        <div id="admin-panel-screen" class="hidden flex h-screen overflow-hidden w-full">
            
            <!-- Sol Kenar Çubuğu (Sidebar) -->
            <aside id="admin-sidebar" class="sidebar flex flex-col p-4 h-full">
                <!-- İçerik JS ile doldurulacak -->
            </aside>

            <!-- Ana İçerik Alanı -->
            <main class="flex-1 overflow-y-auto p-8">
                <header class="mb-10 border-b border-gray-700 pb-4">
                    <h1 class="text-4xl font-extrabold text-white">Yönetici Paneli</h1>
                    <p class="text-gray-400 mt-2">Uygulamanın verilerini ve ayarlarını yönetin.</p>
                </header>

                <div id="panel-content">
                    <!-- İçerik JS ile doldurulacak -->
                </div>
            </main>

        </div>
    </div>

    <!-- Custom Modal (Confirm yerine kullanılır) -->
    <div id="custom-modal" class="fixed inset-0 hidden items-center justify-center">
        <div class="bg-gray-800 p-6 rounded-xl shadow-2xl w-full max-w-sm border border-gray-700 transform transition-all">
            <h3 id="modal-title" class="text-xl font-bold text-white mb-4">Onay Gerekli</h3>
            <p id="modal-message" class="text-gray-300 mb-6">Bu işlemi gerçekleştirmek istediğinizden emin misiniz?</p>
            <div class="flex justify-end space-x-3">
                <button id="modal-cancel" class="py-2 px-4 bg-gray-600 text-white rounded-lg hover:bg-gray-700 transition duration-150">
                    İptal
                </button>
                <button id="modal-confirm" class="py-2 px-4 bg-red-600 text-white rounded-lg hover:bg-red-700 transition duration-150">
                    Onayla
                </button>
            </div>
        </div>
    </div>


    <script>
        // --- Sabitler ve Veriler ---
        const MOCK_CREDENTIALS = {
            'admin': { password: 'sifre123', role: 'admin' },
            'user1': { password: 'user123', role: 'user' },
            'user2': { password: 'user123', role: 'user' }
        };

        let MOCK_DATA = {
            users: { 'user1': 'hash1', 'user2': 'hash2', 'kadir': 'hash3', 'rwr': 'hash4' },
            rooms: { 'room1': 'Genel Sohbet', 'room2': 'Teknik Destek' },
            admins: { 'admin': 'hashA' },
            news_articles: {
                'n1': { title: 'Yeni Özellikler Geliyor!', content: 'Uygulamamız yakında büyük bir güncelleme alacak.' },
                'n2': { title: 'Sunucu Bakımı', content: 'Pazartesi günü 02:00-04:00 arası bakım yapılacaktır.' }
            }
        };

        // Ekran ve Eleman Referansları
        const SCREENS = {
            login: document.getElementById('login-screen'),
            userHome: document.getElementById('user-home-screen'),
            adminPanel: document.getElementById('admin-panel-screen')
        };
        const LOGIN_FORM = document.getElementById('login-form');
        const PANEL_CONTENT = document.getElementById('panel-content');
        const USER_HOME_CONTENT = document.getElementById('user-home-screen');
        const LOGIN_MESSAGE = document.getElementById('login-message');
        const ADMIN_SIDEBAR_ELEM = document.getElementById('admin-sidebar');
        
        // Modal Elemanları
        const MODAL = document.getElementById('custom-modal');
        const MODAL_TITLE = document.getElementById('modal-title');
        const MODAL_MESSAGE = document.getElementById('modal-message');
        const MODAL_CONFIRM = document.getElementById('modal-confirm');
        const MODAL_CANCEL = document.getElementById('modal-cancel');

        let currentState = {
            loggedIn: false,
            username: null,
            role: null,
            currentView: 'user_home'
        };

        // --- Yardımcı Fonksiyonlar ---

        /**
         * alert() ve confirm() yerine kullanılan özel onay kutusu.
         * @param {string} title - Modal başlığı.
         * @param {string} message - Modal mesajı.
         * @returns {Promise<boolean>} - Kullanıcının onaylayıp onaylamadığını döndürür.
         */
        function customConfirm(title, message) {
            return new Promise(resolve => {
                MODAL_TITLE.textContent = title;
                MODAL_MESSAGE.textContent = message;
                MODAL.classList.remove('hidden');
                MODAL.classList.add('flex');

                const confirmHandler = () => {
                    MODAL.classList.add('hidden');
                    MODAL.classList.remove('flex');
                    removeListeners();
                    resolve(true);
                };

                const cancelHandler = () => {
                    MODAL.classList.add('hidden');
                    MODAL.classList.remove('flex');
                    removeListeners();
                    resolve(false);
                };

                MODAL_CONFIRM.addEventListener('click', confirmHandler);
                MODAL_CANCEL.addEventListener('click', cancelHandler);

                const removeListeners = () => {
                    MODAL_CONFIRM.removeEventListener('click', confirmHandler);
                    MODAL_CANCEL.removeEventListener('click', cancelHandler);
                };
            });
        }


        function showMessage(type, message) {
            LOGIN_MESSAGE.classList.remove('hidden', 'flash-success', 'flash-danger');
            LOGIN_MESSAGE.classList.add(type === 'success' ? 'flash-success' : 'flash-danger');
            LOGIN_MESSAGE.innerHTML = message;
        }

        function clearMessage() {
            LOGIN_MESSAGE.classList.add('hidden');
        }

        function generateUniqueId(prefix) {
            return prefix + new Date().getTime();
        }

        /**
         * Kullanıcı rolüne göre görünen kullanıcı adını döndürür.
         * Admin ise [ADMIN] sonekini ekler.
         */
        function getDisplayName(username, role) {
            return username + (role === 'admin' ? ' [ADMIN]' : '');
        }
        
        // --- View Yönetimi ---

        function changeView(viewName) {
            if (currentState.role === 'user' && viewName === 'admin_panel') {
                console.error("Yetkisiz erişim denemesi!");
                return;
            }

            currentState.currentView = viewName;

            // Tüm ekranları gizle
            Object.values(SCREENS).forEach(screen => screen.classList.add('hidden'));

            if (currentState.loggedIn) {
                if (viewName === 'user_home') {
                    SCREENS.userHome.classList.remove('hidden');
                    renderUserDashboard();
                } else if (viewName === 'admin_panel') {
                    SCREENS.adminPanel.classList.remove('hidden');
                    renderPanel();
                }
            } else {
                SCREENS.login.classList.remove('hidden');
            }
            // Lucide ikonlarını yeniden oluştur
            lucide.createIcons();
        }

        // --- Auth Kontrolü ---

        function checkAuth() {
            const loggedIn = sessionStorage.getItem('logged_in') === 'true';
            const username = sessionStorage.getItem('username');
            const role = sessionStorage.getItem('role');

            currentState.loggedIn = loggedIn;
            currentState.username = username;
            currentState.role = role;

            if (loggedIn) {
                changeView('user_home'); // Yöneticiler de ilk buraya düşer.
            } else {
                changeView('login');
            }
        }

        function handleLogin(event) {
            event.preventDefault();
            clearMessage();
            
            const username = event.target.username.value;
            const password = event.target.password.value;

            const user = MOCK_CREDENTIALS[username];

            if (user && user.password === password) {
                sessionStorage.setItem('logged_in', 'true');
                sessionStorage.setItem('username', username);
                sessionStorage.setItem('role', user.role);
                checkAuth();
            } else {
                showMessage('danger', 'Giriş başarısız. Lütfen kullanıcı adı ve şifrenizi kontrol edin.');
            }
        }

        function handleLogout() {
            sessionStorage.clear();
            currentState.loggedIn = false;
            currentState.username = null;
            currentState.role = null;
            changeView('login');
        }

        // --- Kullanıcı Panosu Renderlama ---
        function renderUserDashboard() {
            const is_admin = currentState.role === 'admin';
            const displayName = getDisplayName(currentState.username, currentState.role);
            
            USER_HOME_CONTENT.innerHTML = `
                <div class="w-full max-w-lg bg-gray-800 p-10 rounded-xl shadow-2xl text-center border border-gray-700">
                    <i data-lucide="rocket" class="h-12 w-12 text-indigo-500 mx-auto mb-4"></i>
                    <h2 class="text-3xl font-bold text-white mb-2">Hoş Geldiniz, ${displayName}!</h2>
                    <p class="text-gray-400 mb-8">Bu, uygulamanızın ana kullanıcı arayüzüdür. Buradan programın normal özelliklerini kullanabilirsiniz.</p>
                    
                    ${is_admin ? `
                        <!-- Yöneticiler için özel buton -->
                        <button onclick="changeView('admin_panel')" 
                                class="w-full flex items-center justify-center py-3 px-4 border border-transparent rounded-lg shadow-md text-lg font-semibold text-white bg-green-600 hover:bg-green-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-green-500 transition duration-150 transform hover:scale-[1.02] focus:ring-offset-gray-800">
                            <i data-lucide="shield" class="h-6 w-6 mr-3"></i>
                            Yönetici Paneline Git
                        </button>
                    ` : `
                        <p class="text-gray-500 italic mt-6">Ek özelliklere erişim için yöneticinizle iletişime geçin.</p>
                    `}

                    <button onclick="handleLogout()" class="mt-6 text-red-400 hover:text-red-300 transition duration-150 text-sm">
                        Çıkış Yap
                    </button>
                </div>
            `;
            lucide.createIcons();
        }

        // --- Yönetici Paneli Sidebar Renderlama ---

        function renderAdminSidebar() {
            const displayName = getDisplayName(currentState.username, currentState.role);

            const navItems = [
                { id: 'dashboard', icon: 'layout-dashboard', label: 'Dashboard' },
                { id: 'users', icon: 'users', label: 'Kullanıcılar' },
                { id: 'rooms', icon: 'message-square', label: 'Sohbet Odaları' },
                { id: 'news', icon: 'newspaper', label: 'Haberler' },
            ];

            ADMIN_SIDEBAR_ELEM.innerHTML = `
                <div class="text-xl font-bold text-indigo-400 mb-6 mt-2 pb-4 border-b border-gray-700">
                    <i data-lucide="shield-check" class="inline-block h-6 w-6 mr-2"></i>
                    Yönetim Paneli
                </div>
                
                <!-- Admin Bilgisi -->
                <div class="mb-6 pb-4 border-b border-gray-700">
                    <p class="text-xs text-gray-500">Giriş Yapan:</p>
                    <p class="text-base font-semibold text-white">${displayName}</p>
                </div>

                <nav class="flex-grow space-y-2" id="sidebar-nav-content">
                    ${navItems.map(item => `
                        <a href="#" onclick="showSection('${item.id}')" class="flex items-center p-3 text-sm font-medium text-gray-300 hover:bg-gray-700 rounded-lg transition duration-150 nav-item" data-section="${item.id}">
                            <i data-lucide="${item.icon}" class="h-5 w-5 mr-3"></i>
                            ${item.label}
                        </a>
                    `).join('')}
                </nav>

                <!-- Alt Butonlar -->
                <div class="pt-4 border-t border-gray-700">
                    <button onclick="changeView('user_home')" class="flex items-center p-3 text-sm font-medium text-yellow-400 hover:bg-gray-700 rounded-lg transition duration-150 w-full">
                        <i data-lucide="arrow-left" class="h-5 w-5 mr-3"></i>
                        Kullanıcı Arayüzüne Dön
                    </button>
                    <button onclick="handleLogout()" class="mt-2 flex items-center p-3 text-sm font-medium text-red-400 hover:bg-gray-700 rounded-lg transition duration-150 w-full">
                        <i data-lucide="log-out" class="h-5 w-5 mr-3"></i>
                        Çıkış Yap
                    </button>
                </div>
            `;
            lucide.createIcons();
        }


        // --- Yönetici Panel İçeriği Oluşturma ---
        function renderPanel() {
            // Sidebar'ı oluşturur ve aktif kullanıcı adını ([ADMIN] ibaresiyle) gösterir
            renderAdminSidebar(); 
            
            // İçerik verilerini hesaplar
            const userCount = Object.keys(MOCK_DATA.users).length;
            const roomCount = Object.keys(MOCK_DATA.rooms).length;
            const adminCount = Object.keys(MOCK_CREDENTIALS).filter(u => MOCK_CREDENTIALS[u].role === 'admin').length;
            const newsCount = Object.keys(MOCK_DATA.news_articles).length;

            PANEL_CONTENT.innerHTML = `
                <!-- DASHBOARD BÖLÜMÜ -->
                <section id="dashboard" class="mb-12">
                    <h2 class="text-2xl font-semibold text-gray-200 mb-6 border-b border-gray-700 pb-2 flex items-center">
                        <i data-lucide="bar-chart-3" class="h-5 w-5 mr-2"></i> Genel Bakış
                    </h2>
                    <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
                        <div class="card-bg p-6 rounded-xl shadow-lg border-indigo-500">
                            <div class="flex items-center justify-between">
                                <p class="text-lg font-medium text-gray-400">Toplam Kullanıcı</p>
                                <i data-lucide="users" class="h-8 w-8 text-indigo-400"></i>
                            </div>
                            <p class="text-4xl font-bold text-white mt-2">${userCount}</p>
                        </div>
                        <div class="card-bg p-6 rounded-xl shadow-lg border-green-500">
                            <div class="flex items-center justify-between">
                                <p class="text-lg font-medium text-gray-400">Sohbet Odası</p>
                                <i data-lucide="message-circle" class="h-8 w-8 text-green-400"></i>
                            </div>
                            <p class="text-4xl font-bold text-white mt-2">${roomCount}</p>
                        </div>
                        <div class="card-bg p-6 rounded-xl shadow-lg border-red-500">
                            <div class="flex items-center justify-between">
                                <p class="text-lg font-medium text-gray-400">Yönetici Hesabı</p>
                                <i data-lucide="user-cog" class="h-8 w-8 text-red-400"></i>
                            </div>
                            <p class="text-4xl font-bold text-white mt-2">${adminCount}</p>
                        </div>
                    </div>
                </section>

                <!-- KULLANICILAR BÖLÜMÜ -->
                <section id="users" class="mb-12 hidden">
                    <h2 class="text-2xl font-semibold text-gray-200 mb-6 border-b border-gray-700 pb-2 flex items-center">
                        <i data-lucide="list-checks" class="h-5 w-5 mr-2"></i> Kayıtlı Kullanıcılar (${userCount})
                    </h2>
                    <div class="card-bg p-6 rounded-xl shadow-lg overflow-x-auto">
                        <h3 class="text-xl font-medium text-gray-300 mb-4">Yeni Kullanıcı Ekle</h3>
                        <form id="add-user-form" class="flex flex-wrap gap-4 mb-6 p-4 border border-gray-700 rounded-lg bg-gray-700">
                            <input type="text" name="username" placeholder="Kullanıcı Adı" required 
                                class="flex-1 min-w-[150px] p-2 border border-gray-600 bg-gray-800 text-white rounded-lg focus:ring-indigo-500 focus:border-indigo-500">
                            <input type="password" name="password" placeholder="Şifre" required 
                                class="flex-1 min-w-[150px] p-2 border border-gray-600 bg-gray-800 text-white rounded-lg focus:ring-indigo-500 focus:border-indigo-500">
                            <button type="submit" 
                                class="py-2 px-4 bg-indigo-600 text-white font-medium rounded-lg hover:bg-indigo-700 transition duration-150">
                                Kullanıcı Ekle
                            </button>
                        </form>

                        <h3 class="text-xl font-medium text-gray-300 mb-4 mt-6">Mevcut Kullanıcı Listesi</h3>
                        <table class="min-w-full divide-y divide-gray-700">
                            <thead class="bg-gray-700">
                                <tr>
                                    <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-400 uppercase tracking-wider">Kullanıcı Adı</th>
                                    <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-400 uppercase tracking-wider">İşlemler</th>
                                </tr>
                            </thead>
                            <tbody class="divide-y divide-gray-700">
                                ${Object.keys(MOCK_DATA.users).map(username => `
                                <tr class="hover:bg-gray-700">
                                    <td class="px-6 py-4 whitespace-nowrap text-sm font-medium text-white">${username}</td>
                                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-400 space-x-2">
                                        <button onclick="deleteUser('${username}')" class="text-red-400 hover:text-red-300 font-medium">Sil</button>
                                    </td>
                                </tr>
                                `).join('')}
                            </tbody>
                        </table>
                    </div>
                </section>
                
                <!-- ODALAR BÖLÜMÜ -->
                <section id="rooms" class="mb-12 hidden">
                    <h2 class="text-2xl font-semibold text-gray-200 mb-6 border-b border-gray-700 pb-2 flex items-center">
                        <i data-lucide="globe" class="h-5 w-5 mr-2"></i> Sohbet Odaları (${roomCount})
                    </h2>
                    <div class="card-bg p-6 rounded-xl shadow-lg">
                        <h3 class="text-xl font-medium text-gray-300 mb-4">Yeni Oda Oluştur</h3>
                        <form id="add-room-form" class="flex flex-wrap gap-4 mb-6 p-4 border border-gray-700 rounded-lg bg-gray-700">
                            <input type="text" name="room_name" placeholder="Oda Adı (örn: Genel Sohbet)" required 
                                class="flex-1 min-w-[200px] p-2 border border-gray-600 bg-gray-800 text-white rounded-lg focus:ring-green-500 focus:border-green-500">
                            <button type="submit" 
                                class="py-2 px-4 bg-green-600 text-white font-medium rounded-lg hover:bg-green-700 transition duration-150">
                                Oda Oluştur
                            </button>
                        </form>

                        <h3 class="text-xl font-medium text-gray-300 mb-4 mt-6">Mevcut Odalar</h3>
                        <ul class="space-y-3">
                            ${Object.entries(MOCK_DATA.rooms).map(([id, name]) => `
                            <li class="flex justify-between items-center p-3 bg-gray-700 rounded-lg hover:bg-gray-600 transition duration-150">
                                <span class="font-medium text-white">${name} (ID: ${id})</span>
                                <button onclick="deleteRoom('${id}')" class="text-red-400 hover:text-red-300 text-sm font-medium p-1 rounded-md hover:bg-gray-800">
                                    <i data-lucide="trash-2" class="h-4 w-4"></i>
                                </button>
                            </li>
                            `).join('')}
                        </ul>
                    </div>
                </section>

                <!-- HABERLER BÖLÜMÜ -->
                <section id="news" class="mb-12 hidden">
                    <h2 class="text-2xl font-semibold text-gray-200 mb-6 border-b border-gray-700 pb-2 flex items-center">
                        <i data-lucide="newspaper" class="h-5 w-5 mr-2"></i> Haber Makaleleri (${newsCount})
                    </h2>
                    <div class="card-bg p-6 rounded-xl shadow-lg">
                        <h3 class="text-xl font-medium text-gray-300 mb-4">Yeni Haber Ekle</h3>
                        <form id="add-news-form" class="space-y-4 mb-8 p-4 border border-gray-700 rounded-lg bg-gray-700">
                            <div>
                                <input type="text" name="title" placeholder="Haber Başlığı" required 
                                       class="w-full p-2 border border-gray-600 bg-gray-800 text-white rounded-lg focus:ring-indigo-500 focus:border-indigo-500">
                            </div>
                            <div>
                                <textarea name="content" placeholder="Haber İçeriği" rows="4" required 
                                          class="w-full p-2 border border-gray-600 bg-gray-800 text-white rounded-lg focus:ring-indigo-500 focus:border-indigo-500"></textarea>
                            </div>
                            <button type="submit" 
                                    class="py-2 px-4 bg-indigo-600 text-white font-medium rounded-lg hover:bg-indigo-700 transition duration-150">
                                Haber Yayınla
                            </button>
                        </form>
                        
                        <h3 class="text-xl font-medium text-gray-300 mb-4 mt-6">Yayınlanmış Haberler</h3>
                        <ul class="space-y-4">
                            ${Object.entries(MOCK_DATA.news_articles).map(([id, article]) => `
                            <li class="p-4 border border-gray-700 rounded-lg bg-gray-700 hover:shadow-xl transition duration-150">
                                <div class="flex justify-between items-start">
                                    <h4 class="text-lg font-bold text-white">${article.title}</h4>
                                    <button onclick="deleteNews('${id}')" class="text-red-400 hover:text-red-300 text-sm font-medium p-1 rounded-md hover:bg-gray-800">
                                        <i data-lucide="x-circle" class="h-5 w-5"></i>
                                    </button>
                                </div>
                                <p class="text-sm text-gray-400 mt-2 line-clamp-2">${article.content}</p>
                                <p class="text-xs text-gray-500 mt-1">ID: ${id}</p>
                            </li>
                            `).join('')}
                        </ul>
                    </div>
                </section>
            `;

            // Olay Dinleyicilerini DOM güncellendikten sonra tekrar ata
            attachEventListeners();
            
            // Dashboard'ı göster
            showSection('dashboard');
            lucide.createIcons();
        }

        function attachEventListeners() {
            // Kullanıcı Ekleme Formu
            const addUserForm = document.getElementById('add-user-form');
            if (addUserForm) {
                addUserForm.removeEventListener('submit', handleAddUser); // Önceki dinleyiciyi kaldır
                addUserForm.addEventListener('submit', handleAddUser);     // Yenisini ekle
            }

            // Oda Ekleme Formu
            const addRoomForm = document.getElementById('add-room-form');
            if (addRoomForm) {
                addRoomForm.removeEventListener('submit', handleAddRoom);
                addRoomForm.addEventListener('submit', handleAddRoom);
            }

            // Haber Ekleme Formu
            const addNewsForm = document.getElementById('add-news-form');
            if (addNewsForm) {
                addNewsForm.removeEventListener('submit', handleAddNews);
                addNewsForm.addEventListener('submit', handleAddNews);
            }
        }

        function showSection(sectionId) {
            const sections = ['dashboard', 'users', 'rooms', 'news'];
            sections.forEach(id => {
                const sectionElement = document.getElementById(id);
                if (sectionElement) {
                    sectionElement.classList.add('hidden');
                }
            });

            const targetSection = document.getElementById(sectionId);
            if (targetSection) {
                targetSection.classList.remove('hidden');
            }
            
            // Sidebar aktif linki güncelle
            document.querySelectorAll('#admin-sidebar .nav-item').forEach(item => {
                item.classList.remove('bg-indigo-600', 'text-white');
                item.classList.add('text-gray-300', 'hover:bg-gray-700');
                if (item.getAttribute('data-section') === sectionId) {
                    item.classList.add('bg-indigo-600', 'text-white');
                    item.classList.remove('text-gray-300', 'hover:bg-gray-700');
                }
            });
        }
        
        // --- CRUD İşlemleri (Mock Veri Yönetimi) ---

        function handleAddUser(event) {
            event.preventDefault();
            const username = event.target.username.value.trim();
            const password = event.target.password.value;

            if (!username || !password) return;
            
            if (MOCK_CREDENTIALS[username] || MOCK_DATA.users[username]) {
                // Not: alert yerine customConfirm kullanıyoruz
                customConfirm("Hata", `Kullanıcı adı "${username}" zaten mevcut.`).then(() => { /* Do nothing */ });
                return;
            }

            MOCK_DATA.users[username] = 'mock-hashed-password'; // Mock hash
            
            event.target.username.value = '';
            event.target.password.value = '';

            // İşlem başarılı mesajı (alert yerine customConfirm'i bilgilendirme olarak kullanıyoruz)
            customConfirm("Başarılı", `Kullanıcı "${username}" başarıyla eklendi.`).then(() => {
                renderPanel(); 
            });
        }

        async function deleteUser(username) {
            const confirmed = await customConfirm("Kullanıcı Silme", `Kullanıcıyı (${username}) silmek istediğinizden emin misiniz?`);
            if (confirmed) {
                delete MOCK_DATA.users[username];
                customConfirm("Başarılı", `Kullanıcı "${username}" silindi.`).then(() => {
                    renderPanel();
                });
            }
        }

        function handleAddRoom(event) {
            event.preventDefault();
            const roomName = event.target.room_name.value.trim();
            if (!roomName) return;

            const newId = generateUniqueId('room');
            MOCK_DATA.rooms[newId] = roomName;

            event.target.room_name.value = '';

            customConfirm("Başarılı", `Oda "${roomName}" oluşturuldu.`).then(() => {
                renderPanel();
            });
        }

        async function deleteRoom(id) {
            const roomName = MOCK_DATA.rooms[id] || id;
            const confirmed = await customConfirm("Oda Silme", `"${roomName}" odasını silmek istediğinizden emin misiniz?`);
            if (confirmed) {
                delete MOCK_DATA.rooms[id];
                customConfirm("Başarılı", `Oda "${roomName}" silindi.`).then(() => {
                    renderPanel();
                });
            }
        }

        function handleAddNews(event) {
            event.preventDefault();
            const title = event.target.title.value.trim();
            const content = event.target.content.value.trim();

            if (!title || !content) return;

            const newId = generateUniqueId('news');
            MOCK_DATA.news_articles[newId] = { title, content };

            event.target.title.value = '';
            event.target.content.value = '';

            customConfirm("Başarılı", `Haber "${title}" yayınlandı.`).then(() => {
                renderPanel();
            });
        }

        async function deleteNews(id) {
            const title = MOCK_DATA.news_articles[id]?.title || id;
            const confirmed = await customConfirm("Haber Silme", `"${title}" başlıklı haberi silmek istediğinizden emin misiniz?`);
            if (confirmed) {
                delete MOCK_DATA.news_articles[id];
                customConfirm("Başarılı", `Haber "${title}" silindi.`).then(() => {
                    renderPanel();
                });
            }
        }
        
        // --- Başlatma ---
        window.onload = function() {
            LOGIN_FORM.addEventListener('submit', handleLogin);
            checkAuth();
            lucide.createIcons();
        };

        // Global olarak erişilebilir kılınan fonksiyonlar
        window.handleLogout = handleLogout;
        window.changeView = changeView;
        window.showSection = showSection;
        window.deleteUser = deleteUser;
        window.deleteRoom = deleteRoom;
        window.deleteNews = deleteNews;
        
    </script>
</body>
</html>
